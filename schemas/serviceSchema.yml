$schema: "http://json-schema.org/draft-04/schema#"
title: service
description: |
    This is a detailed specification of a resource
    identified by a unique URI pattern.
$ref: "#/definitions/service"

definitions:

    service:
        description: The service specification
        type: object
        required: [name, description, urlPattern, style, methods]
        properties:
            name:
                description: The name of the service
                type: string
            description:
                description: Short desciption of the service
                type: string
            urlPattern:
                description: The URL pattern of the service
                type: string
            style:
                description: |
                    Tells whether it is an RPC-like OPERATION,
                    or a RESOURCE, which fully comply to the REST principles
                type: string
                enum: [OPERATION, RESOURCE]
            methods:
                $ref: "#/definitions/methods"

    methods:
        description: |
            The methods of the service specification
            There must be at least one method defined for the resource.
            Currently only the most fundamental methods (GET, PUT, POST, DELETE) are provided
        type: object
        minProperties: 1
        maxProperties: 4
        additionalProperties: false
        properties:
            GET:
                description: The specification of the GET method
                $ref: "#/definitions/method"
            PUT:
                description: The specification of the PUT method
                $ref: "#/definitions/method"
            POST:
                description: The specification of the POST method
                $ref: "#/definitions/method"
            DELETE:
                description: The specification of the DELETE method
                $ref: "#/definitions/method"

    method:
        description: Specification of one method
        type: object
        required: [summary, notes, request, responses, testCases]
        properties:
            summary:
                description: Short summary of the service method
                type: string
            notes:
                description: Details and notes about the method
                type: string
            implementation:
                description: "The implementation of the call in the following format: <module>.<function> (optional)"
                type: string
            request:
                description: The detailed specification of request
                $ref: "#/definitions/request"
            responses:
                description: The detailed specification of responses
                $ref: "#/definitions/responses"
            testCases:
                description: The detailed specification of test cases
                $ref: "#/definitions/testCases"

    request:
        description: Specification of the request
        type: object
        required: [parameters, cookies, headers]
        properties:
            parameters:
                $ref: "#/definitions/requestParameters"
            cookies:
                $ref: "#/definitions/cookies"
            headers:
                $ref: "#/definitions/headers"

    testCaseRequest:
        description: Specification of the test case request
        type: object
        required: [cookies, headers]
        properties:
            parameters:
                $ref: "#/definitions/requestParameters"
            cookies:
                $ref: "#/definitions/cookies"
            headers:
                $ref: "#/definitions/headers"

    requestParameters:
        description: Specification of the request parameters
        type: array
        items:
            $ref: "#/definitions/requestParameter"

    requestParameter:
        description: Specification of one request parameter
        type: object
        required: [name, kind, type, required, summary]
        additionalProperties: false
        properties:
            name:
                description: The name of the parameter
                type: string
            kind:
                description: The type of the parameter
                enum: [URL, QUERY, BODY]
            required:
                description: Tells if the parameter is mandatory
                type: boolean
            type:
                description: Defines the type of the paramater
                enum: [string, number, boolean, object]
            summary:
                description: Short summary of the parameter
                type: string
            default:
                description: Default value of the parameter
                anyOf: 
                    - type: string
                    - type: number
                    - type: boolean
                    - type: object

    cookies:
        description: Specification of the cookies
        type: array
        items:
            $ref: "#/definitions/cookie"

    cookie:
        description: Specification of one cookie
        type: object
        required: [field, content]
        additionalProperties: false
        properties:
            field:
                type: string
            content:
                type: string

    headers:
        description: Specification of the headers
        type: array
        items:
            $ref: "#/definitions/header"

    header:
        description: Specification of one header
        type: object
        required: [field, content]
        additionalProperties: false
        properties:
            field:
                type: string
            content:
                type: string

    responses:
        description: Specification of the responses
        type: array
        items:
            $ref: "#/definitions/response"

    response:
        description: Specification of one response
        type: object
        required: [name, statusCode, reason, cookies, headers]
        properties:
            name:
                description: |
                    The name of the response.
                    At least one 'OK' response must be defined.
            statusCode:
                description: The status code of the response
            reason:
                description: The reason of the status code
            validationSchema:
                description: |
                    The JSON-schema to validate the content of the response
                    for example: getMonitoringIsAlive-responseBody-validationSchema.json
            cookies:
                description: The definitions of the response cookies
                $ref: "#/definitions/cookies"
            headers:
                description: The definitions of the response headers
                $ref: "#/definitions/headers"
            mockBody:
                description: |
                    The path to the file which contain the mock response body.
                    For example: getMonitoringIsAlive-responseBody.json

    testCases:
        description: Specification of the test cases
        type: array
        items:
            $ref: "#/definitions/testCase"

    testCase:
        description: Specification of one test case
        type: object
        required: [name, description, url, template, request, response]
        properties:
            name:
                description: The name of the test case
                type: string
            description:
                description: The description of the test case
                type: string
            url:
                description: The URL of the test case
                type: string
            template:
                description: |
                    The path to the template which is used to generate the test case
                    for example: testGetMethod.mustache
                type: string
            request:
                description: The specification of the cookies belong to the request of the test case
                $ref: "#/definitions/testCaseRequest"
            response:
                description: The specification of the cookies belong to the response of the test case
                $ref: "#/definitions/response"
